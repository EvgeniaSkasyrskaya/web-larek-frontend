# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Данные товара
```
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```
Данные о товарах, выбранных покупателем (корзина покупок)
```
interface IBasket {
    items: string[];
}
```
Данные о доставке и оплате товаров
```
interface IDeliveryInfo {
    address: string;
    payMethod: 'cash' | 'card';
}
```
Контактные данные покупателя
```
interface IContacts {
    email: string;
    phone: string;
}
```
Информация о заказе 
```
type IOrder = IDeliveryInfo & IContacts & IBasket
```

Интерфейс модели данных 
```
interface IAppState {
    catalog: IItem[];
    preview: string | null;
    basket: IBasket;                  
    order: IOrder | null;     
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой данных, отвечает за хранение и изменение данных,
- слой представления, отвечает за отображение данных на странице, 
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы: 
- get(uri: string): Promise - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.\
Основные методы, реализуемые классом описаны интерфейсом IEvents:
- on<T>(event: EventName, callback: (data: T) => void): void - подписывает на событие
- emit<T>(event: string, data?: T): void - инициирует событие
- trigger<T>(event: string, context?: Partial<T>): (data: T) => void - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

### Слой данных

#### Класс AppState
Класс отвечает за хранение информации о товарах и данных пользователя, а также за логику работы с данными о товарах, выбранных пользователем для покупки. Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- catalog: IItem[] - массив объектов с информацией о товарах
- preview: string | null - id товара, выбранного для просмотра в модальном окне
- basket: IBasket - массив строк с id товаров, выбранных пользователем для покупки
- order: IOrder | null - объект с информацией о заказе, содержащий данные покупателя и массив строк с id товаров
- events: IEvents - экземпляр класса EventEmitter для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия с этими данными:
- setCatalog(items: IItem[]): void - сохраняет в классе массив данных о товарах
- getItem(id: string): IItem - возвращает объект товара (IItem) по его id
- setPreview(id: string): void - сохраняет значение id товара, выбранного пользователем для просмотра в модальном окне
- addBasketItem(id: string): void - добавляет id выбранного товара в корзину (массив строк, сохраненный в поле basket)
- deleteBasketItem(id: string): void - удаляет id выбранного товара из корзины (массива строк, сохраненного в поле basket)
- getTotalAmount(): number | null - возвращает общее количество товаров в корзине
- getTotalCost(): number | null - возвращает общую стоимость товаров в корзине
- clearBasket(): void - очищает корзину
- setDeliveryFormField(field: keyof IDeliveryInfo, value: string) - сохраняет в классе значение поля ввода в форме заказа
- setContactsFormField(field: keyof IContacts, value: string) - сохраняет в классе значение поля ввода в форме данных пользователя
- validateOrder(): boolean - определяет валидность заполнения данных о заказе
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса


### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. Дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. Конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. \
Класс предоставляет следующие методы:
- setText(element: HTMLElement, value: unknown): void - устанавливает текстовое содержимое элемента
- setDisabled(element: HTMLElement, state: boolean): void - изменяет статус блокировки элемента
- setImage(element: HTMLImageElement, src: string, alt?: string): void - устанавливает изображение с альтернативным текстом
- render(data?: Partial<T>): HTMLElement - сохраняет полученные в параметре данные в полях компонента через его сеттеры, возвращает обновленный контейнер компонента.

#### Класс Page
Расширяет класс Component для типа данных IPage. Предназначен для отображения главного экрана приложения с каталогом товаров. \
Поля класса:
- gallery: HTMLElement - элемент разметки для отображения списка карточек товаров
- basketButton: HTMLButtonElement - элемент разметки для отображения икорки корзины, при клике по которой происходит открытие модального окна с корзиной покупок
- basketCounter: HTMLElement - элемент разметки для отображения количества товаров, находящихся в корзине

#### Класс Card
Расширяет класс Component для типа данных IItem<T>. Класс предназначен для отображения карточки товара в различных вариантах верстки в зависимости от темплейта. В конструктор принимает темплейт карточки товара и экземпляр класса EventEmitter для генерации событий. \
Класс является дженериком и принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в разметке (например, для отображения карточки в каталоге на главной странице это будет тип ICard, а для отображения карточки товара в корзине - тип IBasketItem). \
Поля класса содержат элементы разметки элементов карточки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.

#### Класс CardView
Расширяет класс Card для типа данных IItem. Предназначен для отображения подробной информации о товаре. Дополнительно имеет поле с кнопкой для добавления товара в корзину. Устанавливает слушатель на клик по кнопке, который инициирует событие `basketItem:add` или `basketItem:delete`, в результате которого id товара добавляется или удаляется в массиве поля basket модели данных.\
Поля класса:
- imageElement: HTMLImageElement - элемент разметки с изображением товара
- categoryElement: HTMLElement - элемент разметки для отображения категории товара
- titleElement: HTMLElement - элемент разметки для отображения названия товара
- textElement: HTMLElement - элемент разметки для отображения описания товара
- priceElement: HTMLElement - элемент разметки для отображения цены товара
- button: HTMLButtonElement - кнопка для добавления товара в корзину
Методы:
- toggleButtonText(): void - изменяет текст кнопки в карточке товара в зависимости от наличия/отсутствия товара в корзине
- render(cardData: Partial<IItem>): HTMLElement - расширяет родительский метод, реализуя проверку наличия id товара в массиве, сохраненном в поле basket модели данных. Заполняет элементы карточки данными, а также управляет текстом кнопки в зависимости от наличия/отсутствия товара в корзине. Метод возвращает разметку карточки с установленными слушателями. Слушатели устанавливаются на все интерактивные элементы карточки и генерируют соответствующие события через экземпляр брокера событий.

#### Класс Modal
Класс расширяет класс Component для типа данных IModalData. Реализует отображение модального окна. Так же предоставляет методы open и close для управления отображением модального окна. Конструктор принимает элемент разметки модального окна и экземпляр класса EventEmitter для возможности инициации событий, а также устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.\
Поля класса:
- closeButton: HTMLButtonElement - кнопка закрытия окна
- content: HTMLElement - элемент разметки, являющийся контейнером для содержимого модального окна\

Методы:
- open(): void - открывает модальное окно
- close(): void - закрывает модальное окно при клике на оверлей или кнопке-крестику
- render(data: IModalData): HTMLElement - переопределяет метод render, возвращая готовый элемент разметки модального окна с примененным к нему методом open.

#### Класс Basket
Расширяет класс Component для типа данных IBasketView. Предназначен для отображения корзины покупок. Конструктор принимает HTMLElement и экземпляр класса EventEmitter для возможности инициации событий, а также устанавливает слушатель на клик по кнопке, который инициирует открытие модального окна для заполнения информации о доставке и оплате. \
Поля класса:
- basketList: HTMLElement - элемент разметки для отображения списка карточек товаров
- total: HTMLElement - элемент разметки для отображения общей стоимости товаров в корзине
- submitButton: HTMLButtonElement - кнопка подтверждения
Все поля являются защищенными. Значения полей могут быть установлены или получены через сеттеры и геттеры.

#### Класс Form
Расширяет класс Component для типа данных IFormState. Предназначен для отображения формы, содержащей поля ввода. Конструктор принимает HTMLFormElement и экземпляр класса EventEmitter для возможности инициации событий, а также устанавливает слушатели на изменения полей ввода и на сабмит формы. При сабмите инициирует событие, передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения. Метод render принимает в параметрах данные типа Partial<T> & IFormState (например, для рендера формы заполнения контактных данных пользователя будут передаваться данные типа IContacts & IFormState)\
Поля класса:
- submitButton: HTMLButtonElement - кнопка подтверждения
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов.

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода

#### Класс FormOrder
Расширяет класс Form для типа данных IContacts. Предназначен для реализации формы для заполнения информации о доставке и оплате. Способ оплаты выбирается с помощью кнопок. Конструктор дополнительно устанавливает слушатели на кнопки выбора способа оплаты, при клике на которые генерируется событие `order:change`. Метод render принимает в параметрах данные типа
IDeliveryInfo & IFormState.\
Поля класса:
- buttonCash: HTMLButtonElement 
- buttonCard: HTMLButtonElement

#### Класс OrderSuccess
Расширяет класс Component для типа данных ISuccess. Предназначен для отображения информации в случае успешного оформления заказа. Принимает в конструктор HTMLElement и функцию-обработчик, которая будет вызвана при клике по кнопке.
Поля класса:
- total: HTMLElement - элемент разметки для отображения общей стоимости купленных товаров
- button: HTMLButtonElement - кнопка закрытия окна

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий, генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.


*Список всех событий, которые могут генерироваться в системе:*
*События изменения данных (генерируются классами моделями данных)*
- `items:changed` - изменение массива товаров (следует обновить каталог товаров на главном экране); событие генерируется при вызове метода setCatalog при инициализации приложения
- `preview:changed` - изменение id товара, выбранного для просмотра в модальном окне (следует открыть модальное окно для просмотра товара); событие генерируется при вызове метода setPreview по клику карточки товара в каталоге
- `basket:changed` - изменение массива товаров в корзине (следует обновить отображение счетчика на главном экране и отображение информации в модальном окне корзины покупок); событие генерируется при вызове методов addBasketItem,deleteBasketItem и clearBasket при клике по кнопке в модальном окне просмотра товара и при клике на иконку удаления товара в корзине, а также при успешном оформлении заказа
- `deliveryInfo:changed` - изменение информации о доставке и оплате (следует открыть модальное окно для заполнения контактных данных покупателя); событие генерируется при вызове метода setDeliveryFormField после клика по кнопке модального окна с информацией о доставке и оплату
- `order:changed` - изменение контактных данных покупателя (следует отправить информацию о заказе на сервер, закрыть форму с контактными данными покупателя, отобразить информацию об успешном оформлении товара);

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `item:select` - выбор товара для отображения в модальном окне (событие генерируется при клике карточки товара в каталоге на главной странице) - в результате id товара сохраняется в поле preview модели данных
- `basket:open` - открытие модального окна с отображением корзины (событие генерируется при клике по иконке корзины на главном экране) - следует отобразить модальное окно корзины покупок
- `basketItem:add`- выбор товара для добавления в корзину (событие генерируется при клике по кнопке "В корзину" в окне просмотра карточки товара) - к массиву в поле basket модели данных добавляется id выбранного товара, при этом изменяется текст кнопки в модальном окне просмотра товара
- `basketItem:delete` - выбор товара для удаления из корзины (событие генерируется при клике по кнопке "Убрать из корзины" в окне просмотра карточки товара или при клике по иконке удаления карточки товара в корзине) - id товара удаляется из массива поля basket модели данных, при этом изменяется текст кнопки в модальном окне просмотра товара
- `delivery:open` - открытие модального окна для оформления заказа (событие генерируется при клике по кнопке  "Оформить" в корзине покупок) - следует отобразить модальное окно для заполнения информации о доставке и оплате
- `order:change` - изменение информации о способе оплаты (событие генерируется при клике по кнопке  выбора способа оплаты в соответствующей форме)
- `order:input` - изменение информации об адресе доставки (событие генерируется при вводе данных об адресе доставки в соответствующей форме)
- `order:validation` - событие, сообщающее о необходимости валидации формы с информацией о доставке и оплате
- `order:submit` - сохранение информации о доставке и оплате (событие генерируется при клике по кнопке "Далее" в соответствующей форме) - в результате информация из полей ввода данной формы сохраняется в поле order модели данных
- `contacts:input`- изменение данных в форме с контактными данными пользователя (событие генерируется при вводе данных в полях соответствующей формы)
- `contacts:validation`- событие, сообщающее о необходимости валидации формы с контактными данными пользователя
- `contacts:submit` - сохранение данных о заказе (событие генерируется при клике по кнопке "Оплатить" в форме контактной информации) - в результате информация из полей ввода данной формы сохраняется в поле order модели данных
- `order:finished` - успешное оформление заказа (событие генерируется при клике по кнопке окна успешного оформления заказа) - следует очистить корзину и закрыть модальное окно
